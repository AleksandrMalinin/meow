var data,SERVER_TIMEOUT=15e3,SERVER_STATUS_SUCCESS=200,URL="https://my-json-server.typicode.com/aleksandrmalinin/demo/apartment",INITIAL_LOADED_DATA=12,ZERO_SCROLL_VALUE=0,NORMAL_SCROLL_VALUE=300,container=document.querySelector(".search-results__items-list"),more=document.querySelector(".search-results__more"),inputs=document.querySelectorAll(".search-results__input"),backToTop=document.querySelector(".back-to-top"),email=document.querySelector(".main-footer__email"),submit=document.querySelector(".main-footer__submit"),menuToggle=document.querySelector(".main-nav__toggle"),menuList=document.querySelector(".main-nav"),errorHandler=function(e){var t=document.createElement("div");t.textContent=e;t.style.cssText=["position: fixed","top: 25%","left: 50%","z-index: 100","width: 800px","padding: 20px","color: #fff","text-align: center","transform: translateX(-50%)","border-radius: 2px","background-color: red"].join(";"),document.body.appendChild(t)},reactToServer=function(e,t,r){e.addEventListener("load",function(){e.status===SERVER_STATUS_SUCCESS?t(JSON.parse(e.responseText)):r("Неизвестный статус: "+e.status+" "+e.statusText)}),e.addEventListener("error",function(){r("Ошибка соединения")}),e.addEventListener("timeout",function(){r("Запрос не успел выполниться за "+e.timeout+"мс")})},load=function(e,t){var r=new XMLHttpRequest;reactToServer(r,e,t),r.open("GET",URL),r.timeout=SERVER_TIMEOUT,r.send()},save=function(e,t,r){var s=new XMLHttpRequest;reactToServer(s,t,r),s.open("POST",URL),s.timeout=SERVER_TIMEOUT,s.send(e)},createElements=function(e){var t=document.querySelector(".search-results__item").cloneNode(!0);if(t.querySelector(".search-results__image img").src=e.url,t.querySelector(".search-results__type").textContent=e.title,e.sale)if(t.querySelector(".search-results__promo-number").textContent=e.sale.discount,e.sale.promo)t.querySelector(".search-results__promo-word").textContent=e.sale.promo;else{var r=t.querySelector(".search-results__promo"),s=r.querySelector(".search-results__promo-word");t&&r.removeChild(s)}else{var o=t.querySelector(".search-results__image"),n=o.querySelector(".search-results__promo");n&&o.removeChild(n)}return t.querySelector(".search-results__rooms").textContent=e.rooms,t.querySelector(".search-results__decoration").textContent=e.decoration,t.querySelector(".search-results__space-number").textContent=e.space,t.querySelector(".search-results__floor-number").textContent=e.floor,t.querySelector(".search-results__price").textContent=e.price,t.querySelector(".search-results__status").textContent=e.status,t.querySelector(".search-results__rooms").textContent<1&&t.querySelector(".search-results__caption").classList.add("search-results__caption--studio"),"Забронировано"===t.querySelector(".search-results__status").textContent?t.querySelector(".search-results__status").classList.add("search-results__status--reserved"):"Свободно"===t.querySelector(".search-results__status").textContent?t.querySelector(".search-results__status").classList.add("search-results__status--free"):t.querySelector(".search-results__status").classList.add("search-results__status--sold"),t},renderElement=function(e){[].forEach.call(e,function(e){container.appendChild(createElements(e))})},getDataApartments=function(e){renderFirstTwelve(data=e)},renderFirstTwelve=function(e){for(var t=0;t<INITIAL_LOADED_DATA;t++)data=e.slice(t+1),container.appendChild(createElements(e[t]))};more.addEventListener("click",function(e){e.preventDefault(),renderElement(data)}),load(getDataApartments,errorHandler),[].forEach.call(inputs,function(e){e.addEventListener("click",function(){e.checked&&"price"===e.id?[].slice.call(document.querySelectorAll(".search-results__item"),0).sort(function(e,t){return parseInt(e.querySelector(".search-results__price").textContent.split(" ").join(""))-parseInt(t.querySelector(".search-results__price").textContent.split(" ").join(""))}).forEach(function(e){e.parentNode.appendChild(e)}):[].slice.call(document.querySelectorAll(".search-results__item"),0).sort(function(e,t){return e.querySelector(".search-results__rooms").textContent-t.querySelector(".search-results__rooms").textContent}).forEach(function(e){e.parentNode.appendChild(e)})})}),document.addEventListener("DOMContentLoaded",function(){backToTop.style.display="none",document.querySelectorAll(".search-results__star")}),document.addEventListener("scroll",function(){document.querySelector(".search-results").getBoundingClientRect().top,window.pageYOffset>NORMAL_SCROLL_VALUE?backToTop.style.display="block":backToTop.style.display="none"}),submit.addEventListener("click",function(e){""===email.value&&(e.preventDefault(),email.focus())}),menuToggle.addEventListener("click",function(){menuToggle.classList.toggle("main-nav__toggle--active"),menuList.classList.toggle("main-nav--opened")}),$(document).ready(function(){$("#back-to-top").on("click","a",function(e){e.preventDefault();var t=$(this).attr("href"),r=$(t).offset().top;$("body,html").animate({scrollTop:r},750)})});